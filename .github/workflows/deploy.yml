name: Deploy to Koyeb

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to Koyeb
        uses: koyeb-community/koyeb-actions@v2
        with:
          api_token: ${{ secrets.KOYEB_API_TOKEN }}
          service_name: avito-tiger-bot
          app_name: avito-tiger-bot
          service_type: worker
          build_command: pip install -r requirements.txt
          run_command: python src/bot.py
          ports: "8080:http"
          env: |
            TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}
            TELEGRAM_ADMIN_IDS=${{ secrets.TELEGRAM_ADMIN_IDS }}
            DATABASE_URL=sqlite:///./avito_bot.db
            PYTHON_VERSION=3.11.0
