name: üïê Avito Parser

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

# –≠–¢–û –†–ï–®–ê–ï–¢ –ü–†–û–ë–õ–ï–ú–£ –ö–û–ù–§–õ–ò–ö–¢–ê!
concurrency:
  group: avito-parser
  cancel-in-progress: true

jobs:
  parse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - run: pip install python-telegram-bot aiohttp beautifulsoup4 fake-useragent
      
      # –ù–ï –ó–ê–ü–£–°–ö–ê–ï–ú bot.py, –û–ù –î–õ–Ø –ü–û–õ–õ–ò–ù–ì–ê!
      # –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π cron-—Å–∫—Ä–∏–ø—Ç
      - name: Run cron bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_ADMIN_IDS: ${{ secrets.TELEGRAM_ADMIN_IDS }}
        run: |
          python -c "
import os, asyncio
from telegram import Bot
from datetime import datetime

async def ping():
    bot = Bot(token=os.getenv('TELEGRAM_BOT_TOKEN'))
    for admin_id in os.getenv('TELEGRAM_ADMIN_IDS', '').split(','):
        if admin_id:
            await bot.send_message(
                chat_id=int(admin_id),
                text=f'üïê –ü–∞—Ä—Å–µ—Ä Avito –∑–∞–ø—É—â–µ–Ω: {datetime.now().strftime(\"%H:%M:%S\")}'
            )
    print('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ')

asyncio.run(ping())
          "