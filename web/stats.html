<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avito Tiger - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
        }
        
        .stats-header h1 {
            color: white;
            -webkit-text-fill-color: white;
            margin-bottom: 10px;
        }
        
        .stats-header .last-update {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .filter-panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .filter-button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 48px;
        }
        
        .filter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }
        
        .detailed-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .detailed-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.02);
        }
        
        .detailed-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f7fafc;
            font-size: 1.2em;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f7fafc;
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #666;
        }
        
        .stat-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .trend-up {
            color: #48bb78;
        }
        
        .trend-down {
            color: #fc8181;
        }
        
        .queries-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .queries-table th {
            text-align: left;
            padding: 12px 15px;
            background: #f7fafc;
            color: #666;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .queries-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f7fafc;
        }
        
        .queries-table tr:hover td {
            background: #f7fafc;
        }
        
        .price-history {
            margin-top: 30px;
        }
        
        .time-range {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .time-btn {
            padding: 8px 16px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: #667eea;
            color: white;
        }
        
        @media (max-width: 768px) {
            .filter-panel {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .filter-button {
                width: 100%;
            }
            
            .detailed-stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –•–µ–¥–µ—Ä -->
        <header class="stats-header">
            <h1>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Avito</h1>
            <div class="last-update" id="lastUpdate">
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
            </div>
        </header>

        <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="filter-panel">
            <div class="filter-group">
                <label>üìÖ –ü–µ—Ä–∏–æ–¥</label>
                <select id="periodSelect">
                    <option value="day">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</option>
                    <option value="week" selected>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                    <option value="month">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</option>
                    <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π</option>
                </select>
            </div>
            
            <div class="filter-group" id="customDateRange" style="display: none;">
                <label>–°</label>
                <input type="date" id="startDate">
            </div>
            
            <div class="filter-group" style="display: none;" id="customDateRangeEnd">
                <label>–ü–æ</label>
                <input type="date" id="endDate">
            </div>
            
            <div class="filter-group">
                <label>üîç –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="categorySelect">
                    <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <option value="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                    <option value="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                    <option value="realty">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                    <option value="jobs">–†–∞–±–æ—Ç–∞</option>
                    <option value="services">–£—Å–ª—É–≥–∏</option>
                </select>
            </div>
            
            <button class="filter-button" onclick="applyFilters()">
                –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </button>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="detailed-stats-grid">
            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="detailed-card">
                <h3>üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stat-row">
                    <span class="stat-label">–í—Å–µ–≥–æ –ø–æ–∏—Å–∫–æ–≤:</span>
                    <span class="stat-value" id="totalSearches">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:</span>
                    <span class="stat-value" id="uniqueQueries">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ù–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π:</span>
                    <span class="stat-value" id="totalNewAds">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</span>
                    <span class="stat-value" id="averagePrice">0 ‚ÇΩ</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞:</span>
                    <span class="stat-value" id="medianPrice">0 ‚ÇΩ</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–°–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ:</span>
                    <span class="stat-value" id="maxPrice">0 ‚ÇΩ</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–°–∞–º–æ–µ –¥–µ—à–µ–≤–æ–µ:</span>
                    <span class="stat-value" id="minPrice">0 ‚ÇΩ</span>
                </div>
            </div>

            <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
            <div class="detailed-card">
                <h3>‚è± –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                <div class="stat-row">
                    <span class="stat-label">–°–µ–≥–æ–¥–Ω—è:</span>
                    <span class="stat-value" id="todaySearches">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–í—á–µ—Ä–∞:</span>
                    <span class="stat-value" id="yesterdaySearches">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–≠—Ç–∞ –Ω–µ–¥–µ–ª—è:</span>
                    <span class="stat-value" id="weekSearches">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ü—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è:</span>
                    <span class="stat-value" id="lastWeekSearches">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ü–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</span>
                    <span class="stat-value" id="peakTime">20:00-21:00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–í—ã—Ö–æ–¥–Ω—ã–µ:</span>
                    <span class="stat-value" id="weekendActivity">‚Üì 15%</span>
                </div>
            </div>

            <!-- –¶–µ–Ω–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
            <div class="detailed-card">
                <h3>üí∞ –¶–µ–Ω–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                <div class="stat-row">
                    <span class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –¥–µ–Ω—å:</span>
                    <span class="stat-value" id="dailyChange">+2.3% üìà</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –Ω–µ–¥–µ–ª—é:</span>
                    <span class="stat-value" id="weeklyChange">-1.5% üìâ</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –º–µ—Å—è—Ü:</span>
                    <span class="stat-value" id="monthlyChange">+5.7% üìà</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:</span>
                    <span class="stat-value" id="volatility">–°—Ä–µ–¥–Ω—è—è</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ò–Ω–¥–µ–∫—Å Avito:</span>
                    <span class="stat-value" id="avitoIndex">124.5 ‚Üë</span>
                </div>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
        <div class="charts-grid">
            <div class="chart-card full-width">
                <h2>üìà –î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)</h2>
                <div class="time-range">
                    <button class="time-btn active" onclick="changeTimeRange('day')">–î–µ–Ω—å</button>
                    <button class="time-btn" onclick="changeTimeRange('week')">–ù–µ–¥–µ–ª—è</button>
                    <button class="time-btn" onclick="changeTimeRange('month')">–ú–µ—Å—è—Ü</button>
                    <button class="time-btn" onclick="changeTimeRange('quarter')">–ö–≤–∞—Ä—Ç–∞–ª</button>
                </div>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="detailedPriceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- –¢–æ–ø –∑–∞–ø—Ä–æ—Å–æ–≤ -->
        <div class="chart-card full-width" style="margin-top: 25px;">
            <h2>üîç –¢–æ–ø-50 –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</h2>
            <table class="queries-table" id="queriesTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–ó–∞–ø—Ä–æ—Å</th>
                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th>–î–æ–ª—è</th>
                        <th>–°—Ä. —Ü–µ–Ω–∞</th>
                        <th>–î–∏–Ω–∞–º–∏–∫–∞</th>
                    </tr>
                </thead>
                <tbody id="queriesTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
        <div class="export-buttons">
            <button class="export-btn" onclick="exportData('csv')">
                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
            </button>
            <button class="export-btn" onclick="exportData('json')">
                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
            </button>
            <button class="export-btn" onclick="printReport()">
                üñ® –ü–µ—á–∞—Ç—å –æ—Ç—á–µ—Ç–∞
            </button>
        </div>
    </div>

    <script>
        // ===================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====================
        let priceChart = null;
        let trendsData = {};
        let pricesData = {};
        let reportsData = [];

        // ===================== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• =====================
        async function loadData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–Ω–¥—ã
                const trendsResponse = await fetch('../data/trends.json');
                if (trendsResponse.ok) {
                    trendsData = await trendsResponse.json();
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–Ω—ã
                const pricesResponse = await fetch('../data/prices.json');
                if (pricesResponse.ok) {
                    pricesData = await pricesResponse.json();
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç—á–µ—Ç—ã
                const reportsResponse = await fetch('../data/daily_reports/');
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                
                updateUI();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showDemoData();
            }
        }

        // ===================== –î–ï–ú–û-–î–ê–ù–ù–´–ï =====================
        function showDemoData() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—èÈ¢ÑËßà
            document.getElementById('totalSearches').innerHTML = '12,547';
            document.getElementById('uniqueQueries').innerHTML = '1,234';
            document.getElementById('totalNewAds').innerHTML = '3,891';
            document.getElementById('averagePrice').innerHTML = '45,990 ‚ÇΩ';
            document.getElementById('medianPrice').innerHTML = '32,500 ‚ÇΩ';
            document.getElementById('maxPrice').innerHTML = '2,500,000 ‚ÇΩ';
            document.getElementById('minPrice').innerHTML = '500 ‚ÇΩ';
            document.getElementById('todaySearches').innerHTML = '847';
            document.getElementById('yesterdaySearches').innerHTML = '912';
            document.getElementById('weekSearches').innerHTML = '5,234';
            document.getElementById('lastWeekSearches').innerHTML = '4,987';
            document.getElementById('dailyChange').innerHTML = '+2.3% üìà';
            document.getElementById('weeklyChange').innerHTML = '-1.5% üìâ';
            document.getElementById('monthlyChange').innerHTML = '+5.7% üìà';
            document.getElementById('lastUpdate').innerHTML = 'üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ' + new Date().toLocaleString('ru-RU');
            
            // –î–µ–º–æ-—Ç–∞–±–ª–∏—Ü–∞
            renderDemoTable();
            renderDemoChart();
        }

        function renderDemoTable() {
            const demoQueries = [
                ['iphone 13', '1,547', '12.3%', '54,990 ‚ÇΩ', '+2.5% üìà'],
                ['macbook', '987', '7.8%', '89,990 ‚ÇΩ', '-1.2% üìâ'],
                ['ps5', '876', '6.9%', '45,990 ‚ÇΩ', '+5.3% üìà'],
                ['–≤–µ–ª–æ—Å–∏–ø–µ–¥', '654', '5.2%', '15,990 ‚ÇΩ', '-0.8% üìâ'],
                ['–¥–∏–≤–∞–Ω', '543', '4.3%', '12,990 ‚ÇΩ', '+1.2% üìà'],
                ['airpods', '432', '3.4%', '8,990 ‚ÇΩ', '-2.1% üìâ'],
                ['–≤–µ–ª–æ—Å–∏–ø–µ–¥ –≤–∑—Ä–æ—Å–ª—ã–π', '321', '2.5%', '18,990 ‚ÇΩ', '+0.5% üìà'],
                ['–º–æ–Ω–∏—Ç–æ—Ä', '298', '2.4%', '16,990 ‚ÇΩ', '-1.8% üìâ'],
                ['–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞', '265', '2.1%', '3,990 ‚ÇΩ', '+0.9% üìà'],
                ['–Ω–∞—É—à–Ω–∏–∫–∏', '234', '1.9%', '4,990 ‚ÇΩ', '-0.3% üìâ']
            ];
            
            let html = '';
            demoQueries.forEach((q, i) => {
                html += `<tr>
                    <td>${i + 1}</td>
                    <td><strong>${q[0]}</strong></td>
                    <td>${q[1]}</td>
                    <td>${q[2]}</td>
                    <td>${q[3]}</td>
                    <td class="${q[4].includes('üìà') ? 'trend-up' : 'trend-down'}">${q[4]}</td>
                </tr>`;
            });
            
            document.getElementById('queriesTableBody').innerHTML = html;
        }

        function renderDemoChart() {
            const ctx = document.getElementById('detailedPriceChart')?.getContext('2d');
            if (!ctx) return;
            
            if (priceChart) priceChart.destroy();
            
            const dates = [];
            for (let i = 0; i < 30; i++) {
                const d = new Date();
                d.setDate(d.getDate() - (29 - i));
                dates.push(d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' }));
            }
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'iPhone 13',
                            data: Array.from({length: 30}, () => 54000 + Math.random() * 2000),
                            borderColor: '#667eea',
                            backgroundColor: '#667eea20',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'MacBook',
                            data: Array.from({length: 30}, () => 89000 + Math.random() * 3000),
                            borderColor: '#764ba2',
                            backgroundColor: '#764ba220',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'PS5',
                            data: Array.from({length: 30}, () => 45000 + Math.random() * 2000),
                            borderColor: '#48bb78',
                            backgroundColor: '#48bb7820',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω –∑–∞ 30 –¥–Ω–µ–π'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' ‚ÇΩ';
                                }
                            }
                        }
                    }
                }
            });
        }

        // ===================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê =====================
        function updateUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            document.getElementById('lastUpdate').innerHTML = 
                'üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ' + new Date().toLocaleString('ru-RU');
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        }

        // ===================== –§–ò–õ–¨–¢–†–´ =====================
        function applyFilters() {
            const period = document.getElementById('periodSelect').value;
            const category = document.getElementById('categorySelect').value;
            
            console.log('Applying filters:', { period, category });
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ —Å –Ω–æ–≤—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
            renderDemoChart();
        }

        function changeTimeRange(range) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
            event.target.classList.add('active');
            
            // –ú–µ–Ω—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –≥—Ä–∞—Ñ–∏–∫–∞
            renderDemoChart();
        }

        // ===================== –≠–ö–°–ü–û–†–¢ =====================
        function exportData(format) {
            if (format === 'csv') {
                let csv = '–ó–∞–ø—Ä–æ—Å,–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ,–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞,–î–∏–Ω–∞–º–∏–∫–∞\n';
                
                if (trendsData && Object.keys(trendsData).length > 0) {
                    Object.entries(trendsData).forEach(([query, count]) => {
                        csv += `${query},${count},0,0%\n`;
                    });
                } else {
                    // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                    const demoQueries = [
                        ['iphone 13', 1547, 54990, '+2.5'],
                        ['macbook', 987, 89990, '-1.2'],
                        ['ps5', 876, 45990, '+5.3']
                    ];
                    demoQueries.forEach(q => {
                        csv += `${q[0]},${q[1]},${q[2]},${q[3]}%\n`;
                    });
                }
                
                // –°–∫–∞—á–∏–≤–∞–µ–º CSV
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `avito_stats_${new Date().toISOString().slice(0,10)}.csv`;
                link.click();
            }
            
            if (format === 'json') {
                const data = {
                    trends: trendsData,
                    prices: pricesData,
                    exported_at: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `avito_stats_${new Date().toISOString().slice(0,10)}.json`;
                link.click();
            }
        }

        function printReport() {
            window.print();
        }

        // ===================== –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–ö–ê–ó–ê –ü–†–û–ò–ó–í–û–õ–¨–ù–û–ì–û –ü–ï–†–ò–û–î–ê =====================
        document.getElementById('periodSelect').addEventListener('change', function() {
            const customRange = document.getElementById('customDateRange');
            const customRangeEnd = document.getElementById('customDateRangeEnd');
            
            if (this.value === 'custom') {
                customRange.style.display = 'block';
                customRangeEnd.style.display = 'block';
            } else {
                customRange.style.display = 'none';
                customRangeEnd.style.display = 'none';
            }
        });

        // ===================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====================
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const today = new Date();
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            
            document.getElementById('startDate').value = weekAgo.toISOString().slice(0,10);
            document.getElementById('endDate').value = today.toISOString().slice(0,10);
        });
    </script>
</body>
</html>